<?php

declare(strict_types=1);

namespace Ganchenkov\ColdHot\View;

use function cli\line;
use function cli\prompt;

/**
 * –í—ã–≤–æ–¥–∏—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã.
 */
function showWelcome(): void
{
    line('');
    line('===========================================');
    line('   –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏–≥—Ä—É "–•–æ–ª–æ–¥–Ω–æ-–≥–æ—Ä—è—á–æ"!');
    line('===========================================');
    line('');
    line('–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã:');
    line('  - –ö–æ–º–ø—å—é—Ç–µ—Ä –∑–∞–≥–∞–¥–∞–ª —Ç—Ä–µ—Ö–∑–Ω–∞—á–Ω–æ–µ —á–∏—Å–ª–æ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ü–∏—Ñ—Ä');
    line('  - –ü–µ—Ä–≤–∞—è —Ü–∏—Ñ—Ä–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω—É–ª–µ–º');
    line('  - –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏:');
    line('    * –ì–æ—Ä—è—á–æ - —Ü–∏—Ñ—Ä–∞ –Ω–∞ —Å–≤–æ–µ–º –º–µ—Å—Ç–µ');
    line('    * –¢–µ–ø–ª–æ  - —Ü–∏—Ñ—Ä–∞ –µ—Å—Ç—å, –Ω–æ –Ω–µ –Ω–∞ —Å–≤–æ–µ–º –º–µ—Å—Ç–µ');
    line('    * –•–æ–ª–æ–¥–Ω–æ - —Ç–∞–∫–æ–π —Ü–∏—Ñ—Ä—ã –Ω–µ—Ç –≤ —á–∏—Å–ª–µ');
    line('  - –ü–æ–¥—Å–∫–∞–∑–∫–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∞–ª—Ñ–∞–≤–∏—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ');
    line('');
}

/**
 * –ß–∏—Ç–∞–µ—Ç –≤–≤–æ–¥ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–∏—Ä–∏–ª–ª–∏—Ü—ã –≤ Windows.
 *
 * @return string –í–≤–µ–¥—ë–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
 */
function readInput(): string
{
    // –ß–∏—Ç–∞–µ–º —Å—ã—Ä—ã–µ –±–∞–π—Ç—ã –∏–∑ STDIN
    $input = fgets(STDIN);
    
    if ($input === false || $input === '') {
        return '';
    }
    
    // –£–±–∏—Ä–∞–µ–º –ø–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–æ–∫–∏
    $input = rtrim($input, "\r\n");
    
    // –ï—Å–ª–∏ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ —Å—Ç—Ä–æ–∫–∏ —á—Ç–æ-—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º
    // –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ "–ø—É—Å—Ç–æ—Ç—É" —á–µ—Ä–µ–∑ empty(), —Ç.–∫. –∫–∏—Ä–∏–ª–ª–∏—Ü–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –¥—Ä—É–≥–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–µ
    if ($input !== '') {
        return $input;
    }
    
    return '';
}

/**
 * –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∏–º—è –∏–≥—Ä–æ–∫–∞.
 *
 * @return string –í–≤–µ–¥–µ–Ω–Ω–æ–µ –∏–º—è –∏–≥—Ä–æ–∫–∞
 */
function showPromptName(): string
{
    echo '–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è: ';
    return readInput();
}

/**
 * –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–ø—ã—Ç–∫—É —É–≥–∞–¥–∞—Ç—å —á–∏—Å–ª–æ.
 *
 * @return string –í–≤–µ–¥–µ–Ω–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞
 */
function showPromptGuess(): string
{
    echo '–í–≤–µ–¥–∏—Ç–µ —Ç—Ä–µ—Ö–∑–Ω–∞—á–Ω–æ–µ —á–∏—Å–ª–æ: ';
    return readInput();
}


/**
 * –í—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ—Å–ª–µ –ø–æ–ø—ã—Ç–∫–∏.
 *
 * @param array $hints –ú–∞—Å—Å–∏–≤ –ø–æ–¥—Å–∫–∞–∑–æ–∫
 */
function showHints(array $hints): void
{
    line('–ü–æ–¥—Å–∫–∞–∑–∫–∏: %s', implode(' ', $hints));
}

/**
 * –í—ã–≤–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–±–µ–¥–µ.
 *
 * @param int $attempts –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
 */
function showVictory(int $attempts): void
{
    line('');
    line('üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã —É–≥–∞–¥–∞–ª–∏ —á–∏—Å–ª–æ –∑–∞ %d –ø–æ–ø—ã—Ç–æ–∫!', $attempts);
    line('');
}

/**
 * –í—ã–≤–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ.
 *
 * @param string $message –¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
 */
function showError(string $message): void
{
    line('–û—à–∏–±–∫–∞: %s', $message);
}

/**
 * –í—ã–≤–æ–¥–∏—Ç —Å–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–∏–π.
 *
 * @param array $games –ú–∞—Å—Å–∏–≤ –∏–≥—Ä –∏–∑ –ë–î
 */
function showGamesList(array $games): void
{
    line('');
    line('=== –°–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–∏–π ===');
    line('');
    line('%-4s | %-20s | %-15s | %-6s | %-10s', 'ID', '–î–∞—Ç–∞', '–ò–≥—Ä–æ–∫', '–ß–∏—Å–ª–æ', '–†–µ–∑—É–ª—å—Ç–∞—Ç');
    line(str_repeat('-', 65));
    
    foreach ($games as $game) {
        $outcome = $game['outcome'] ?? '–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ';
        line(
            '%-4s | %-20s | %-15s | %-6s | %-10s',
            $game['id'],
            $game['created_at'],
            $game['player_name'],
            $game['secret_number'],
            $outcome
        );
    }
    line('');
}

/**
 * –í—ã–≤–æ–¥–∏—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏–∏.
 *
 * @param array $game –î–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã
 * @param array $attempts –ú–∞—Å—Å–∏–≤ –ø–æ–ø—ã—Ç–æ–∫
 */
function showReplay(array $game, array $attempts): void
{
    line('');
    line('=== –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏–∏ #%d ===', $game['id']);
    line('');
    line('–ò–≥—Ä–æ–∫: %s', $game['player_name']);
    line('–î–∞—Ç–∞: %s', $game['created_at']);
    line('–ó–∞–≥–∞–¥–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ: %s', $game['secret_number']);
    line('–†–µ–∑—É–ª—å—Ç–∞—Ç: %s', $game['outcome'] ?? '–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ');
    line('');
    
    if (empty($attempts)) {
        line('–ü–æ–ø—ã—Ç–æ–∫ –Ω–µ –±—ã–ª–æ.');
    } else {
        line('–ü–æ–ø—ã—Ç–∫–∏:');
        foreach ($attempts as $attempt) {
            line(
                '  %d. %s -> %s',
                $attempt['attempt_number'],
                $attempt['guess'],
                $attempt['hints']
            );
        }
    }
    line('');
}

/**
 * –í—ã–≤–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∏–≥—Ä.
 */
function showNoGames(): void
{
    line('');
    line('–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–∏–π –ø–æ–∫–∞ –Ω–µ—Ç.');
    line('–ó–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–æ–≤—É—é –∏–≥—Ä—É —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º --new –∏–ª–∏ -n');
    line('');
}

/**
 * –í—ã–≤–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–Ω–∞–π–¥–µ–Ω–Ω–æ–π –∏–≥—Ä–µ.
 *
 * @param int $id ID –∏–≥—Ä—ã
 */
function showGameNotFound(int $id): void
{
    line('');
    line('–ò–≥—Ä–∞ —Å ID %d –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.', $id);
    line('');
}

/**
 * –í—ã–≤–æ–¥–∏—Ç —Å–ø—Ä–∞–≤–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.
 */
function showHelp(): void
{
    line('');
    line('–ò–≥—Ä–∞ "–•–æ–ª–æ–¥–Ω–æ-–≥–æ—Ä—è—á–æ" (cold-hot)');
    line('================================');
    line('');
    line('–û–ø–∏—Å–∞–Ω–∏–µ:');
    line('  –ö–æ–Ω—Å–æ–ª—å–Ω–∞—è –∏–≥—Ä–∞, –≤ –∫–æ—Ç–æ—Ä–æ–π –Ω—É–∂–Ω–æ —É–≥–∞–¥–∞—Ç—å —Ç—Ä–µ—Ö–∑–Ω–∞—á–Ω–æ–µ —á–∏—Å–ª–æ');
    line('  –±–µ–∑ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ü–∏—Ñ—Ä. –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –ø–æ–¥—Å–∫–∞–∑–∫–∏.');
    line('');
    line('–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:');
    line('  cold-hot [–ø–∞—Ä–∞–º–µ—Ç—Ä—ã]');
    line('');
    line('–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:');
    line('  -n, --new          –ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É');
    line('  -l, --list         –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–∏–π');
    line('  -r, --replay <ID>  –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –ø–∞—Ä—Ç–∏—é –ø–æ ID');
    line('  -h, --help         –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É');
    line('');
    line('–ü—Ä–∏–º–µ—Ä—ã:');
    line('  cold-hot --new');
    line('  cold-hot -l');
    line('  cold-hot --replay 5');
    line('');
}

/**
 * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Å–ø–∏—Å–∫–µ.
 * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É, —Å–æ–¥–µ—Ä–∂–∞—â—É—é ID, –¥–∞—Ç—É, –∏–º—è –∏–≥—Ä–æ–∫–∞, —Å–µ–∫—Ä–µ—Ç–Ω–æ–µ —á–∏—Å–ª–æ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
 *
 * @param array $game –î–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã
 * @return string –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
 */
function formatGameForList(array $game): string
{
    $outcome = $game['outcome'] ?? '–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ';
    return sprintf(
        'ID: %s | –î–∞—Ç–∞: %s | –ò–≥—Ä–æ–∫: %s | –ß–∏—Å–ª–æ: %s | –†–µ–∑—É–ª—å—Ç–∞—Ç: %s',
        $game['id'],
        $game['created_at'],
        $game['player_name'],
        $game['secret_number'],
        $outcome
    );
}
